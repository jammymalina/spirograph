define(["require","exports","./math","./colour"],function(t,s,e,i){!function(t){t[t.FD=0]="FD",t[t.LT=1]="LT",t[t.RT=2]="RT",t[t.SXY=3]="SXY",t[t.SA=4]="SA",t[t.SC=5]="SC",t[t.SLW=6]="SLW",t[t.PD=7]="PD",t[t.PU=8]="PU"}(s.TurtleCommand||(s.TurtleCommand={}));var o=s.TurtleCommand,n=function(){function t(t,s,e,i,o,n){void 0===o&&(o=!0),void 0===n&&(n={line_width:1,colour:{r:0,g:0,b:0}}),i?this._canvas=i:this._canvas=document.getElementsByTagName("canvas").length>0?document.getElementsByTagName("canvas")[0]:document.createElement("canvas"),this.save_command_history=!1,this.ctx=this.canvas.getContext("2d"),this._x=t,this._y=s,this.set_angle(e),this._pendown=!0,this._style={colour:{r:0,g:0,b:0},line_width:1},this.colour=n.colour,this.line_width=n.line_width,this.save_command_history=o,this.command_history=[]}return t.prototype.fd=function(t){var s=this.save_command_history;this.save_command_history=!1,this.set_xy(this.x+Math.sin(this.angle*e.DEG_TO_RAD)*t,this.y-Math.cos(this.angle*e.DEG_TO_RAD)*t),this.save_command_history=s,this.save_command_history&&this.push_command({action:o.FD,args:[t]})},t.prototype.set_xy=function(t,s){this._pendown&&(this.ctx.beginPath(),this.ctx.strokeStyle=this.ctx_colour,this.ctx.lineWidth=this.line_width,this.ctx.moveTo(this.x,this.y),this.ctx.lineTo(t,s),this.ctx.stroke()),this._x=t,this._y=s,this.save_command_history&&this.push_command({action:o.SXY,args:[t,s]})},t.prototype.lt=function(t){var s=this.save_command_history;this.save_command_history=!1,this.set_angle(this.angle-t),this.save_command_history=s,this.save_command_history&&this.push_command({action:o.LT,args:[t]})},t.prototype.rt=function(t){var s=this.save_command_history;this.save_command_history=!1,this.set_angle(this.angle+t),this.save_command_history=s,this.save_command_history&&this.push_command({action:o.RT,args:[t]})},t.prototype.set_angle=function(t){this._angle=e.mod(t,360),this.save_command_history&&this.push_command({action:o.SA,args:[t]})},t.prototype.up=function(){this._pendown=!1,this.save_command_history&&this.push_command({action:o.PU,args:[]})},t.prototype.down=function(){this._pendown=!0,this.save_command_history&&this.push_command({action:o.PD,args:[]})},t.prototype.is_pen_down=function(){return this._pendown},t.prototype.push_command=function(){for(var t=this,s=[],e=0;e<arguments.length;e++)s[e-0]=arguments[e];s.forEach(function(s){return t.command_history.push(s)})},t.prototype.clear_command_history=function(){this.command_history.splice(0)},t.prototype.refresh=function(t,s,e,i){var n=this.save_command_history;this.save_command_history=!1,void 0!==t&&(this._x=t),void 0!==s&&(this._y=s),void 0!==e&&(this.angle=e),i&&(this.colour=i.colour,this.line_width=i.line_width);for(var a=0;a<this.command_history.length;a++){var h=this.command_history[a];switch(h.action){case o.FD:this.fd(h.args[0]);break;case o.LT:this.lt(h.args[0]);break;case o.RT:this.rt(h.args[0]);break;case o.SXY:this.set_xy(h.args[0],h.args[1]);break;case o.SA:this.set_angle(h.args[0]);break;case o.SC:this.colour=h.args[0];break;case o.SLW:this.line_width=h.args[0];break;case o.PD:this.down();break;case o.PU:this.up()}}this.save_command_history=n},Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},set:function(t){this._canvas=t,this.ctx=this._canvas.getContext("2d")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this.set_xy(t,this._y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this.set_xy(this._x,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(t){this.set_angle(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colour",{get:function(){return this._style.colour},set:function(t){i.colour_clamp(t),this._style.colour=t,this.save_command_history&&this.push_command({action:o.SC,args:[t]})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ctx_colour",{get:function(){return i.colour_to_ctx_style(this.colour)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"line_width",{get:function(){return this._style.line_width},set:function(t){this._style.line_width=Math.abs(t),this.save_command_history&&this.push_command({action:o.SLW,args:[t]})},enumerable:!0,configurable:!0}),t}();s.Turtle=n});