var __extends=this&&this.__extends||function(t,n){function e(){this.constructor=t}for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)};define(["require","exports"],function(t,n){function e(t){return"number"==typeof t}n.multiply_vec3_vec3=function(t,n){return t.x*n.x+t.y*n.y+t.z*n.z},n.multiply_vec2_vec2=function(t,n){return t.x*n.x+t.y*n.y},n.multiply_scalar_vec2=function(t,n,e){return e||(e=new r),e.set(t*n.x,t*n.y),e},n.multiply_scalar_vec3=function(t,n,e){return e||(e=new m),e.set(t*n.x,t*n.y,t*n.z),e},n.multiply_scalar_mat3=function(t,n,e){return e||(e=new a),e.set(t*n.m11,t*n.m12,t*n.m13,t*n.m31,t*n.m32,t*n.m33,t*n.m21,t*n.m22,t*n.m23),e},n.multiply_mat3_mat3=function(t,n,e){return e||(e=new a),e.set(t.m11*n.m11+t.m12*n.m21+t.m13*n.m31,t.m11*n.m12+t.m12*n.m22+t.m13*n.m32,t.m11*n.m13+t.m12*n.m23+t.m13*n.m33,t.m21*n.m11+t.m22*n.m21+t.m23*n.m31,t.m21*n.m12+t.m22*n.m22+t.m23*n.m32,t.m21*n.m13+t.m22*n.m23+t.m23*n.m33,t.m31*n.m11+t.m32*n.m21+t.m33*n.m31,t.m31*n.m12+t.m32*n.m22+t.m33*n.m32,t.m31*n.m13+t.m32*n.m23+t.m33*n.m33),e},n.multiply_mat3_vec3=function(t,n,e){return e||(e=new m),e.set(n.x*t.m11+n.y*t.m12+n.z*t.m13,n.x*t.m21+n.y*t.m22+n.z*t.m23,n.x*t.m31+n.y*t.m32+n.z*t.m33),e},n.multiply_vec3_mat3=function(t,n,e){return e||(e=new m),e.set(n.m31*t.z+n.m21*t.y+n.m11*t.x,n.m32*t.z+n.m22*t.y+n.m12*t.x,n.m33*t.z+n.m23*t.y+n.m13*t.x),e},n.multiply=function(t,i,o){if(e(t)&&e(i))return t*i;if(t instanceof r&&i instanceof r)return n.multiply_vec2_vec2(t,i);if(t instanceof m&&i instanceof m)return n.multiply_vec3_vec3(t,i);var s=null;return e(t)&&i instanceof r?!o||o instanceof r?(s=o?o:new r,n.multiply_scalar_vec2(t,i,s),s):null:t instanceof r&&e(i)?!o||o instanceof r?(s=o?o:new r,n.multiply_scalar_vec2(i,t,s),s):null:e(t)&&i instanceof m?!o||o instanceof m?(s=o?o:new m,n.multiply_scalar_vec3(t,i,s),s):null:t instanceof m&&e(i)?!o||o instanceof m?(s=o?o:new m,n.multiply_scalar_vec3(i,t,s),s):null:e(t)&&i instanceof a?!o||o instanceof a?(s=o?o:new a,n.multiply_scalar_mat3(t,i,s),s):null:t instanceof a&&e(i)?!o||o instanceof a?(s=o?o:new a,n.multiply_scalar_mat3(i,t,s),s):null:t instanceof m&&i instanceof a?!o||o instanceof m?(s=s?o:new m,n.multiply_vec3_mat3(t,i,s),s):null:t instanceof a&&i instanceof m?!o||o instanceof m?(s=o?o:new m,n.multiply_mat3_vec3(t,i,s),s):null:t instanceof a&&i instanceof a&&(!o||o instanceof a)?(s=o?o:new a,n.multiply_mat3_mat3(t,i,s),s):null};var i=function(){function t(t){t=Math.round(Math.abs(t)),this.data=new Float32Array(t)}return t.prototype.apply=function(t){for(var n=0;n<this.data.length;n++)this.data[n]=t(this.data[n])},t.prototype.abs=function(){this.apply(Math.abs)},t}(),r=function(t){function n(){for(var n=[],e=0;e<arguments.length;e++)n[e-0]=arguments[e];t.call(this,2),0==n.length?this.set(0):this.set.apply(this,n)}return __extends(n,t),n.prototype.set=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];1==t.length?(this.x=t[0],this.y=t[0]):2==t.length&&(this.x=t[0],this.y=t[1])},n.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(t.length<=0)return new n(0);for(var i=new n(t[0].x,t[0].y),r=1;r<t.length;r++)i.x+=t[r].x,i.y+=t[r].y;return i},n.sub=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(t.length<=0)return new n(0);for(var i=new n(t[0].x,t[0].y),r=1;r<t.length;r++)i.x-=t[r].x,i.y-=t[r].y;return i},n.min=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(t.length<=0)return new n(0);for(var i=new n(t[0].x,t[0].y),r=1;r<t.length;r++)i.x=Math.min(i.x,t[r].x),i.y=Math.min(i.y,t[r].y);return i},n.max=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(t.length<=0)return new n(0);for(var i=new n(t[0].x,t[0].y),r=1;r<t.length;r++)i.x=Math.max(i.x,t[r].x),i.y=Math.max(i.y,t[r].y);return i},Object.defineProperty(n.prototype,"x",{get:function(){return this.data[0]},set:function(t){this.data[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this.data[1]},set:function(t){this.data[1]=t},enumerable:!0,configurable:!0}),n}(i);n.vec2=r;var m=function(t){function n(){for(var n=[],e=0;e<arguments.length;e++)n[e-0]=arguments[e];t.call(this,3),0==n.length?this.set(0):this.set.apply(this,n)}return __extends(n,t),n.prototype.set=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];1==t.length?(this.x=t[0],this.y=t[0],this.z=t[0]):2==t.length?(this.x=t[0],this.y=t[1],this.z=0):3==t.length&&(this.x=t[0],this.y=t[1],this.z=t[2])},n.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(t.length<=0)return new n(0);for(var i=new n(t[0].x,t[0].y),r=1;r<t.length;r++)i.x+=t[r].x,i.y+=t[r].y,i.z+=t[r].z;return i},n.sub=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(t.length<=0)return new n(0);for(var i=new n(t[0].x,t[0].y),r=1;r<t.length;r++)i.x-=t[r].x,i.y-=t[r].y,i.z-=t[r].z;return i},n.min=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(t.length<=0)return new n(0);for(var i=new n(t[0].x,t[0].y,t[0].z),r=1;r<t.length;r++)i.x=Math.min(i.x,t[r].x),i.y=Math.min(i.y,t[r].y),i.z=Math.min(i.y,t[r].z);return i},n.max=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(t.length<=0)return new n(0);for(var i=new n(t[0].x,t[0].y,t[0].z),r=1;r<t.length;r++)i.x=Math.max(i.x,t[r].x),i.y=Math.max(i.y,t[r].y),i.z=Math.max(i.y,t[r].z);return i},Object.defineProperty(n.prototype,"x",{get:function(){return this.data[0]},set:function(t){this.data[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this.data[1]},set:function(t){this.data[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"z",{get:function(){return this.data[2]},set:function(t){this.data[2]=t},enumerable:!0,configurable:!0}),n}(i);n.vec3=m;var a=function(t){function e(){for(var n=[],e=0;e<arguments.length;e++)n[e-0]=arguments[e];t.call(this,9),0==n.length?this.set(0):this.set.apply(this,n)}return __extends(e,t),e.prototype.set=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];if(1==t.length)for(var e=0;e<this.data.length;e++)this.data[e]=t[0];else 6==t.length?(this.m11=t[0],this.m12=t[1],this.m13=t[2],this.m21=t[3],this.m22=t[4],this.m23=t[5],this.m31=0,this.m32=0,this.m33=1):9==t.length&&(this.m11=t[0],this.m12=t[1],this.m13=t[2],this.m21=t[3],this.m22=t[4],this.m23=t[5],this.m31=t[6],this.m32=t[7],this.m33=t[8])},e.prototype.set_translate=function(t){var n=t instanceof r?t.x:t,e=t instanceof r?t.y:t;this.m13=n,this.m23=e},e.prototype.set_rotate=function(t){var n=Math.sin(t),e=Math.cos(t);this.m11=e,this.m12=-n,this.m21=n,this.m22=e},e.prototype.set_scale=function(t){var n=t instanceof r?t.x:t,e=t instanceof r?t.y:t;this.m11=n,this.m22=e},e.prototype.multiply=function(t,e){return n.multiply(this,t,e),e},e.prototype.reverse_mutliply=function(t,e){return n.multiply(t,this,e),e},e.identity=function(t){return t||(t=new e),t.set(1,0,0,0,1,0,0,0,1),t},e.transformation_matrix=function(t,i,r,m,a){if(void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===m&&(m="srt"),a||(a=new e),e.identity(a),!m||""==m)return a;var o={};if(o.t=m.indexOf("t")!=-1?e.translation_matrix(t):null,o.r=m.indexOf("r")!=-1?e.rotation_matrix(i):null,o.s=m.indexOf("s")!=-1?e.scale_matrix(r):null,null!=o.t||null!=o.r||null!=o.s)for(var s=m.length-1;s>=0;s--)"t"!=m[s]&&"r"!=m[s]&&"s"!=m[s]||n.multiply_mat3_mat3(a,o[m[s]],a);return a},e.translation_matrix=function(t,n){n||(n=new e);var i=t instanceof r?t.x:t,m=t instanceof r?t.y:t;return n.m11=1,n.m12=0,n.m13=i,n.m21=0,n.m22=1,n.m23=m,n.m31=0,n.m32=0,n.m33=1,n},e.rotation_matrix=function(t,n){n||(n=new e);var i=Math.sin(t),r=Math.cos(t);return n.m11=r,n.m12=-i,n.m13=0,n.m21=i,n.m22=r,n.m23=0,n.m31=0,n.m32=0,n.m33=1,n},e.scale_matrix=function(t,n){n||(n=new e);var i=t instanceof r?t.x:t,m=t instanceof r?t.y:t;return n.m11=i,n.m12=0,n.m13=0,n.m21=0,n.m22=m,n.m23=0,n.m31=0,n.m32=0,n.m33=1,n},e.inverse=function(t,n){var i=t.determinant;return 0==i?e.identity(n):(n||(n=new e),i=1/i,n.m11=(t.m22*t.m33-t.m23*t.m32)*i,n.m12=(t.m13*t.m32-t.m12*t.m33)*i,n.m13=(t.m12*t.m23-t.m13*t.m22)*i,n.m21=(t.m23*t.m31-t.m21*t.m33)*i,n.m22=(t.m11*t.m33-t.m13*t.m31)*i,n.m23=(t.m13*t.m21-t.m11*t.m23)*i,n.m31=(t.m21*t.m32-t.m22*t.m31)*i,n.m32=(t.m12*t.m31-t.m11*t.m32)*i,n.m33=(t.m11*t.m22-t.m12*t.m21)*i,n)},Object.defineProperty(e.prototype,"determinant",{get:function(){return this.m11*(this.m33*this.m22-this.m32*this.m23)+this.m21*(-this.m33*this.m12+this.m32*this.m13)+this.m31*(this.m23*this.m12-this.m22*this.m13)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"m11",{get:function(){return this.data[0]},set:function(t){this.data[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"m12",{get:function(){return this.data[3]},set:function(t){this.data[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"m13",{get:function(){return this.data[6]},set:function(t){this.data[6]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"m21",{get:function(){return this.data[1]},set:function(t){this.data[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"m22",{get:function(){return this.data[4]},set:function(t){this.data[4]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"m23",{get:function(){return this.data[7]},set:function(t){this.data[7]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"m31",{get:function(){return this.data[2]},set:function(t){this.data[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"m32",{get:function(){return this.data[5]},set:function(t){this.data[5]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"m33",{get:function(){return this.data[8]},set:function(t){this.data[8]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ctx_transform",{get:function(){return[this.m11,this.m21,this.m12,this.m22,this.m13,this.m23]},enumerable:!0,configurable:!0}),e}(i);n.mat3=a});